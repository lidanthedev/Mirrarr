<!-- Single provider results partial -->
{% if provider_results %}
<details class="group" open>
    <summary
        class="flex items-center justify-between p-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg cursor-pointer transition-colors list-none">
        <div class="flex items-center gap-3">
            <svg class="h-4 w-4 text-slate-400 transition-transform group-open:rotate-90" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <span class="font-medium text-white">{{ provider_name }}</span>
            <span class="text-sm text-slate-400">{{ provider_results|length }} option(s)</span>
        </div>
    </summary>

    <div class="mt-2 ml-7 space-y-1">
        {% for result in provider_results %}
        {% set payload = {
        "url": result.download_url,
        "quality": result.quality,
        "source": result.source_site,
        "media_type": media_type,
        "tmdb_id": tmdb_id,
        "season": season,
        "episode": episode,
        "filename": result.filename or ""
        } %}
        <button class="provider-result-item flex items-center gap-2 w-full p-2 bg-slate-800/50 hover:bg-slate-800 rounded-lg
        transition-colors group/item text-left" onclick="queueDownload({{ payload | tojson | forceescape }})"
            data-quality="{{ result.quality }}" data-size-mb="{{ (result.size / 1048576)|round(2) }}"
            data-download-url="{{ result.download_url }}" data-source="{{ result.source_site }}"
            data-filename="{{ result.filename or '' }}" data-provider-name="{{ result.provider_name or '' }}">
            <div class="p-1.5 bg-slate-600 rounded group-hover/item:bg-primary-600 transition-colors flex-shrink-0 hidden sm:block">
                <svg class="h-3 w-3 sm:h-3.5 sm:w-3.5 text-slate-300 group-hover/item:text-white transition-colors" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
            </div>
            <div class="flex-1 min-w-0 flex flex-col sm:flex-row sm:items-center gap-x-3">
                <span class="font-bold text-white text-xs sm:text-sm flex-shrink-0">{{ result.quality }}</span>
                {% if result.filename %}
                <span class="text-[10px] sm:text-xs text-slate-400 truncate flex-1 min-w-0" title="{{ result.filename }}">
                    {{ result.filename }}
                </span>
                {% endif %}
            </div>
            <span class="text-[10px] sm:text-sm font-medium text-slate-300 flex-shrink-0 bg-slate-700/50 px-2 py-0.5 rounded">
                {% if result.size >= 1073741824 %}
                {{ "%.1f"|format(result.size / 1073741824) }} GB
                {% else %}
                {{ "%.0f"|format(result.size / 1048576) }} MB
                {% endif %}
            </span>
        </button>
        {% endfor %}
    </div>
</details>
{% else %}
<!-- Provider returned no results -->
<details class="group">
    <summary
        class="flex items-center justify-between p-3 bg-slate-700/30 rounded-lg cursor-pointer list-none opacity-60">
        <div class="flex items-center gap-3">
            <svg class="h-4 w-4 text-slate-500 transition-transform group-open:rotate-90" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <span class="font-medium text-slate-400">{{ provider_name }}</span>
            <span class="text-sm text-slate-500">No results</span>
        </div>
    </summary>
</details>
{% endif %}